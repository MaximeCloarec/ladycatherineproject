---
import BaseLayout from "../layouts/BaseLayout.astro";
import Header from "../components/Header.astro";

import Footer from "../components/Footer.astro";
import "../styles/global.css";
import { requestHasLocale } from "astro:i18n";

const pageTitle = "Contact";

if (Astro.request.method === "POST") {
    try{
        const data = await Astro.request.formData();

        const response = await fetch("http://localhost:8080/contact/send", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body : JSON.stringify({
                lastname: data.get("lastname"),
                firstname: data.get("firstname"),
                email: data.get("email"),
                message: data.get("message"),
            }),
        });

        if (response.ok) {
            
            return Astro.redirect("/contact?success=1");
        }
        console.log("Backend response (error):", await response.text());
    } catch (error){
        console.log("Erreur : ", error);
    }
}
const success = Astro.url.searchParams.get("success");
---

<style>
section.contact {
    max-width: 600px;
    margin: 2rem auto;
    text-align: center;
}

.separate{
    border: solid black 1px;
    max-width: 80%;
    text-align: center;
    margin: 1rem auto;
}
form {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    text-align: left;
    
    padding: 2rem;
    margin-top: 5%;
}

label span {
    font-weight: bolder;
    margin-bottom: 0.5rem;
    display: block;
    text-align: center;
}

input, textarea {
    width: 100%;
    padding: 0.75rem;
    border: 2px solid white;
    border-radius: 20px;
    background: #3B73CC;
    color: white;

    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3); /* décalage-x, décalage-y, flou, couleur */
    transition: box-shadow 0.2s ease-in-out;
}

input:focus, textarea:focus {
    outline: none;
    border-color: #2563eb;
    box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.3);
}

button {
    background: white;
    color: black;
    font-weight: bold;
    padding: 0.75rem 1rem;
    border: none;
    border-radius: 0.5rem;
    cursor: pointer;
    transition: background 0.2s;
    max-width: 60%;
    margin: auto;
}

button:hover {
    background: #1d4ed8;
}

</style>


<BaseLayout pageTitle={pageTitle}>
    <section class="contact">
        <h2>Contact us</h2>
        <hr>
        <p>Have a question, an idea, or a project? Send us a message!</p>

        { success === "1" && (
            <div style="
            background: #4ade80;
                color: black;
                padding: 1rem;
                margin: 1rem auto;
                max-width: 400px;
                border-radius: 10px;
                text-align: center;
                font-weight: bold;
                box-shadow: 0 4px 6px rgba(0,0,0,0.2);
            ">
                ✅ Your message has been sent successfully!
            </div>
        )}

        <form method="POST">
        <label>
            <span>Last name</span>
            <input type="text" name="lastname" placeholder="Your last name" required />
        </label>

        <label>
            <span>First name</span>
            <input type="text" name="firstname" placeholder="Your first name" required />
        </label>

        <label>
            <span>Email</span>
            <input
            type="email"
            name="email"
            placeholder="myemail@exemple.com"
            required
            />
        </label>

        <label>
            <span>Message</span>
            <textarea
            name="message"
            rows="5"
            placeholder="Your message..."
            required></textarea>
        </label>

        <button type="submit">Submit</button>
        </form>
    </section>
</BaseLayout>
